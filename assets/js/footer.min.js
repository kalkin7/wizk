!function(){"use strict";var t={init:function(){var t,e;return(t=this.config.scope.querySelector(this.config.divFootnotesQuery))?(e=t.querySelectorAll(this.config.footnotesQuery),this.footnoteButtonsBuilder(e),t.parentNode.removeChild(t),void this.actionSetup()):!1},removeBackLinks:function(t,e){var o;return e.indexOf(" ")>=0&&(e=e.trim().replace(/\s+/g,"|").replace(/(.*)/g,"($1)")),o=new RegExp("(\\s|&nbsp;)*<\\s*a[^#<]*#"+e+"[^>]*>(.*?)<\\s*/\\s*a>","g"),t.replace(o,"").replace("[]","")},buildButton:function(t,e,o,n){return this.config.fnButtonMarkup.replace(/\{\{FOOTNOTEREFID\}\}/g,t).replace(/\{\{FOOTNOTEID\}\}/g,e).replace(/\{\{FOOTNOTENUMBER\}\}/g,o).replace(/\{\{FOOTNOTECONTENT\}\}/g,n)},buildContent:function(t,e){return this.config.fnContentMarkup.replace(/\{\{FOOTNOTEID\}\}/g,t).replace(/\{\{FOOTNOTECONTENT\}\}/g,e)},clickAction:function(t){var e,o,n,i,r,a;return e=t.target,o=e.getAttribute("data-fn-content"),n=e.getAttribute("data-footnote"),e.nextElementSibling?void this.removeFootnotes():(this.removeFootnotes(),i=this.buildContent(n,o),e.insertAdjacentHTML("afterend",i),r=e.nextElementSibling,a=window.innerHeight>0?window.innerHeight:window.availHeight,this.calculateOffset(r,e),this.calculateSpacing(r,this.calculateMargins(r),a),e.classList.add("is-active"),r.classList.add("footnote-is-active"),void("ontouchstart"in document.documentElement&&document.body.classList.add("footnote-backdrop")))},calculateOffset:function(t,e){var o,n,i,r,a,c,s,l,d,u,f,h;e="undefined"!=typeof e?e:t.previousElementSibling,i=e.offsetLeft,r=e.offsetWidth,o=t.querySelector(".footnote-tooltip"),u=o.clientWidth,n=t.parentNode,a=n.clientWidth,c=n.offsetLeft,s=t.offsetWidth,l=-(s/2-a/2),h=window.outerWidth>0?window.outerWidth:window.availWidth,0>c+l?l-=c+l:c+l+s>h&&(l-=c+l+s-h),t.style.left=l+"px",d=c+l,f=c-d+a/2-u/2,o.style.left=f+"px"},getTransitionEvent:function(){var t,e,o;e=document.createElement("fake"),o={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in o)if(void 0!==e.style[t])return o[t]},removeFootnoteChild:function(t){t.parentNode.removeChild(t)},removeFootnotes:function(){var t,e;e=this.getTransitionEvent(),t=document.querySelectorAll(".footnote-is-active"),t.length>0&&(Array.prototype.forEach.call(t,function(t){t.previousElementSibling.classList.remove("is-active"),e?t.addEventListener(e,this.removeFootnoteChild.bind(this,t),!1):this.once(this.removeFootnoteChild(t)),t.classList.remove("footnote-is-active")}.bind(this)),document.body.classList.contains("footnote-backdrop")&&document.body.classList.remove("footnote-backdrop"))},debounce:function(t,e,o){var n;return function(){var i=this,r=arguments,a=function(){n=null,o||t.apply(i,r)},c=o&&!n;clearTimeout(n),n=setTimeout(a,e),c&&t.apply(i,r)}},resizeAction:function(){var t;t=document.querySelectorAll(".footnote-is-active"),t.length>0&&Array.prototype.forEach.call(t,function(t){this.calculateOffset(t),this.calculateSpacing(t)}.bind(this))},calculateSpacing:function(t,e,o){var n,i,r;e="undefined"!=typeof e?e:this.calculateMargins(t),o="undefined"!=typeof o?o:window.innerHeight,o=o>0?o:window.availHeight,n=t.getBoundingClientRect(),i=n.height,r=n.bottom,r>o-e[1]?t.classList.add("footnote-is-top"):o-(i+e[0])>r&&t.classList.contains("footnote-is-top")&&t.classList.remove("footnote-is-top")},scrollAction:function(){var t;if(t=document.querySelectorAll(".footnote-is-active"),t.length>0){var e,o;e=window.innerHeight>0?window.innerHeight:window.availHeight,o=this.calculateMargins(t[0]),Array.prototype.forEach.call(t,function(t){this.calculateSpacing(t,o,e)}.bind(this))}},calculateMargins:function(t){var e=window.getComputedStyle(t,null);return[parseFloat(e.marginTop),parseFloat(e.marginBottom)]},closestClass:function(t,e){do try{if(t.classList.contains(e))return t}catch(o){if(o instanceof TypeError)return null}while(t=t.parentNode);return null},documentAction:function(t){this.closestClass(t.target,"footnote-container")||this.removeFootnotes()},actionSetup:function(){var t;t=this.config.scope.querySelectorAll(".footnote-button"),Array.prototype.forEach.call(t,function(t){t.addEventListener("click",this.clickAction.bind(this))}.bind(this)),window.addEventListener("resize",this.debounce(this.resizeAction.bind(this),100)),window.addEventListener("scroll",this.debounce(this.scrollAction.bind(this),100)),document.body.addEventListener("click",this.documentAction.bind(this)),document.body.addEventListener("touchend",this.documentAction.bind(this))},footnoteButtonsBuilder:function(t){Array.prototype.forEach.call(t,function(t,e){var o,n,i,r,a,c;a=e+1,i=t.id,n=t.querySelector("a[href^='#fnref']").getAttribute("href").substring(1),o=this.removeBackLinks(t.innerHTML.trim(),n),o=o.replace(/"/g,"&quot;").replace(/&lt;/g,"&ltsym;").replace(/&gt;/g,"&gtsym;"),0!==o.indexOf("<")&&(o="<p>"+o+"</p>"),r=document.getElementById(n),c='<div class="footnote-container">'+this.buildButton(n,i,a,o)+"</div>",r.insertAdjacentHTML("afterend",c),r.parentNode.removeChild(r)}.bind(this))},config:{scope:document,divFootnotesQuery:".footnotes",footnotesQuery:"[id^='fn']",fnButtonMarkup:'<button class="footnote-button" id="{{FOOTNOTEREFID}}" data-footnote="{{FOOTNOTEID}}" alt="See Footnote {{FOOTNOTENUMBER}}" rel="footnote" data-fn-number="{{FOOTNOTENUMBER}}" data-fn-content="{{FOOTNOTECONTENT}}"></button>',fnContentMarkup:'<div class="littlefoot-footnote" id="{{FOOTNOTEID}}"><div class="footnote-wrapper"><div class="footnote-content">{{FOOTNOTECONTENT}}</div></div><div class="footnote-tooltip" aria-hidden="true"></div>'}};t.init()}();